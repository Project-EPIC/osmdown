<style>
.link {
  stroke: #ccc;
}

.node text {
  pointer-events: none;
  font: 10px sans-serif;
}
</style>

<div id="networktest" style="width:100%;">
  <svg id="vis" class="network"></svg>
</div>
<h2>Available Networks</h2>
<ul id="available-networks">
</ul>


<script type="text/javascript">
var width = 960,
    height = 500;

var color = d3.scale.category10();

var force = d3.layout.force()
  .gravity(.15)
  .distance(100)
  .charge(-50)
  .size([width, height]);


function chooseNetwork(file){
  d3.selectAll("#vis > *").remove();
  console.log(file)
  $.getJSON(file, function(json, err){

    var svg = d3.select("#vis") // d3.select("#vis")
      .attr("width", width)
      .attr("height", height);

    force
      .nodes(json.nodes)
      .links(json.links)
      .start();

    var link = svg.selectAll(".link")
      .data(json.links)
      .enter().append("line")
        .attr("class", "link")
        .style("stroke-width", function(d) { return d.weight });

    var node = svg.selectAll(".node")
      .data(json.nodes)
      .enter().append("circle")
        .attr("class", "node")
        .attr("r", 5)
        .style("fill", function(d) { if(d.status=="Experienced"){return color(10)}else{ return color(0)}})
        .call(force.drag);

    node.append("text")
        .attr("dx", 12)
        .attr("dy", ".35em")
        .text(function(d) { return d.id });

    force.on("tick", function() {
      link.attr("x1", function(d) { return d.source.x; })
          .attr("y1", function(d) { return d.source.y; })
          .attr("x2", function(d) { return d.target.x; })
          .attr("y2", function(d) { return d.target.y; });

      node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
    });
  });
}

var files = {{{files}}}
var path  = "{{{path }}}"
files.forEach(function(file){

  $("#available-networks").append("<li onClick='chooseNetwork("+JSON.stringify(path+file)+")'>"+file+"</li>")
})

</script>
